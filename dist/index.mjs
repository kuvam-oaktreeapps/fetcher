var k=Object.defineProperty;var U=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var b=(a,r,e)=>r in a?k(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e,S=(a,r)=>{for(var e in r||(r={}))w.call(r,e)&&b(a,e,r[e]);if(U)for(var e of U(r))j.call(r,e)&&b(a,e,r[e]);return a};var q=(a,r,e)=>new Promise((g,h)=>{var l=n=>{try{u(e.next(n))}catch(i){h(i)}},t=n=>{try{u(e.throw(n))}catch(i){h(i)}},u=n=>n.done?g(n.value):Promise.resolve(n.value).then(l,t);u((e=e.apply(a,r)).next())});import{useEffect as x,useState as f}from"react";var L=a=>a.replace(/\/$/g,"");var O=class{constructor(r,e){this.defaultRequestOps={method:"GET",headers:{"Content-Type":"application/json"},body:void 0,params:{}};this.baseUrl=L(r),this.headers=()=>S({"Content-Type":"application/json",Accept:"application/json"},e==null?void 0:e())}request(g){return q(this,arguments,function*(r,e=this.defaultRequestOps){var s;let h=null,l=null,t,u,n=this.baseUrl+r;Object.keys(e.params||{}).length>0&&(n+=new URLSearchParams(e.params).toString());try{t=yield fetch(n,{headers:S(S({},(s=this.headers)==null?void 0:s.call(this)),e==null?void 0:e.headers),method:e==null?void 0:e.method,body:e!=null&&e.body&&(e==null?void 0:e.method)!=="GET"?JSON.stringify(e==null?void 0:e.body):void 0})}catch(E){return console.error(E),l={status:0,fetchResponse:null,data:null},{data:h,error:l}}let i=yield t.text();try{u=i?JSON.parse(i):null}catch(E){u=i}return t.ok?h=u:l={status:t.status,fetchResponse:t,data:u},{data:h,error:l}})}useQuery(r,e){let[g,h]=f(null),[l,t]=f(null),[u,n]=f(!0),i=(...E)=>q(this,[...E],function*(s={}){var y,m,R,T;n(!0),(y=e==null?void 0:e.onLoadingStart)==null||y.call(e);let{data:c,error:d}=yield this.request(r,{headers:e==null?void 0:e.headers,method:(e==null?void 0:e.method)||"GET",params:s});return n(!1),(m=e==null?void 0:e.onLoadingEnd)==null||m.call(e),d?(t(d),(R=e==null?void 0:e.onError)==null||R.call(e,{status:d.status,fetchResponse:d.fetchResponse,data:c})):c?(h(c),(T=e==null?void 0:e.onSuccess)==null||T.call(e,c)):console.log("No data or error returned from request!"),{data:c,error:d}});return x(()=>{i()},[]),{data:g,error:l,refetch:i,isLoading:u,isError:!!l}}useMutation(r,e){let[g,h]=f(null),[l,t]=f(null),[u,n]=f(!0);return{data:g,error:l,mutate:(s,E)=>q(this,null,function*(){var y,m,R,T;n(!0),(y=e==null?void 0:e.onLoadingStart)==null||y.call(e);let{data:c,error:d}=yield this.request(r,{body:s,headers:e==null?void 0:e.headers,method:(e==null?void 0:e.method)||"POST",params:E});return n(!1),(m=e==null?void 0:e.onLoadingEnd)==null||m.call(e),d?(t(d),(R=e==null?void 0:e.onError)==null||R.call(e,{status:d.status,fetchResponse:d.fetchResponse,data:c})):c?(h(c),(T=e==null?void 0:e.onSuccess)==null||T.call(e,c)):console.log("No data or error returned from request!"),{data:c,error:d}}),isLoading:u,isError:!!l}}},M=a=>new O(a.baseUrl,a.headers);export{M as createFetcher};
