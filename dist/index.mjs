var P=Object.defineProperty,C=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var j=(r,n,e)=>n in r?P(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,o=(r,n)=>{for(var e in n||(n={}))k.call(n,e)&&j(r,e,n[e]);if(S)for(var e of S(n))w.call(n,e)&&j(r,e,n[e]);return r},U=(r,n)=>C(r,M(n));var x=(r,n)=>{var e={};for(var t in r)k.call(r,t)&&n.indexOf(t)<0&&(e[t]=r[t]);if(r!=null&&S)for(var t of S(r))n.indexOf(t)<0&&w.call(r,t)&&(e[t]=r[t]);return e};var T=(r,n,e)=>new Promise((t,d)=>{var u=a=>{try{i(e.next(a))}catch(f){d(f)}},c=a=>{try{i(e.throw(a))}catch(f){d(f)}},i=a=>a.done?t(a.value):Promise.resolve(a.value).then(u,c);i((e=e.apply(r,n)).next())});import{useEffect as D,useState as R}from"react";var q=r=>r.replace(/\/$/g,""),N=r=>r.startsWith("/")?r:`/${r}`,b=r=>q(N(r));var L=class{constructor(n,e){this.baseUrl=q(n||"/"),this.headers=()=>o({"Content-Type":"application/json",Accept:"application/json"},e==null?void 0:e())}request(t){return T(this,arguments,function*(n,e={}){var g,s;let d={method:e.method||"GET",body:JSON.stringify(e.body),headers:o(o({"Content-Type":"application/json",Accept:"application/json"},(g=this.headers)==null?void 0:g.call(this)),e==null?void 0:e.headers)},u=null,c=null,i,a,f=this.baseUrl+b(n);if(Object.keys(e.params||{}).length>0){let l=e.params||{},{pathname:h}=l,y=x(l,["pathname"]);f+=((s=e.params)!=null&&s.pathname?b(e.params.pathname):"")+"?"+new URLSearchParams(y).toString()}try{i=yield fetch(f,d)}catch(h){return console.error(h),c={status:0,fetchResponse:null,data:null},{data:u,error:c}}let m=yield i.text();try{a=m?JSON.parse(m):null}catch(h){a=m}return i.ok?u=a:c={status:i.status,fetchResponse:i,data:a},{data:u,error:c}})}useQuery(n,e){let[t,d]=R(null),[u,c]=R(null),[i,a]=R(!0),f=m=>T(this,null,function*(){var s,h,y,E;a(!0),(s=e==null?void 0:e.onLoadingStart)==null||s.call(e);let{data:g,error:l}=yield this.request(n,U(o({},e),{params:m}));return a(!1),(h=e==null?void 0:e.onLoadingEnd)==null||h.call(e),l?(c(l),(y=e==null?void 0:e.onError)==null||y.call(e,{status:l.status,fetchResponse:l.fetchResponse,data:g})):g?(d(g),(E=e==null?void 0:e.onSuccess)==null||E.call(e,g)):console.log("No data or error returned from request!"),{data:g,error:l}});return D(()=>{f(e==null?void 0:e.params)},[]),{data:t,error:u,refetch:f,isLoading:i,isError:!!u}}useMutation(n,e){let[t,d]=R(null),[u,c]=R(null),[i,a]=R(!0);return{data:t,error:u,mutate:(m,g)=>T(this,null,function*(){var h,y,E,O;a(!0),(h=e==null?void 0:e.onLoadingStart)==null||h.call(e);let{data:l,error:s}=yield this.request(n,U(o({},e),{body:m,params:g}));return a(!1),(y=e==null?void 0:e.onLoadingEnd)==null||y.call(e),s?(c(s),(E=e==null?void 0:e.onError)==null||E.call(e,{status:s.status,fetchResponse:s.fetchResponse,data:l})):l?(d(l),(O=e==null?void 0:e.onSuccess)==null||O.call(e,l)):console.log("No data or error returned from request!"),{data:l,error:s}}),isLoading:i,isError:!!u}}},$=r=>new L(r==null?void 0:r.baseUrl,r==null?void 0:r.headers);export{$ as createFetcher};
