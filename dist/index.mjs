var x=Object.defineProperty;var E=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;var j=(r,n,e)=>n in r?x(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,S=(r,n)=>{for(var e in n||(n={}))k.call(n,e)&&j(r,e,n[e]);if(E)for(var e of E(n))o.call(n,e)&&j(r,e,n[e]);return r};var w=(r,n)=>{var e={};for(var t in r)k.call(r,t)&&n.indexOf(t)<0&&(e[t]=r[t]);if(r!=null&&E)for(var t of E(r))n.indexOf(t)<0&&o.call(r,t)&&(e[t]=r[t]);return e};var U=(r,n,e)=>new Promise((t,h)=>{var c=a=>{try{i(e.next(a))}catch(d){h(d)}},u=a=>{try{i(e.throw(a))}catch(d){h(d)}},i=a=>a.done?t(a.value):Promise.resolve(a.value).then(c,u);i((e=e.apply(r,n)).next())});import{useEffect as C,useState as R}from"react";var q=r=>r.replace(/\/$/g,""),P=r=>r.startsWith("/")?r:`/${r}`,O=r=>q(P(r));var b=class{constructor(n,e){this.baseUrl=q(n||"/"),this.headers=()=>S({"Content-Type":"application/json",Accept:"application/json"},e==null?void 0:e())}request(t){return U(this,arguments,function*(n,e={}){var f,s;let h={method:e.method||"GET",body:JSON.stringify(e.body),headers:S(S({"Content-Type":"application/json",Accept:"application/json"},(f=this.headers)==null?void 0:f.call(this)),e==null?void 0:e.headers)},c=null,u=null,i,a,d=this.baseUrl+O(n);if(Object.keys(e.params||{}).length>0){let l=e.params||{},{pathname:g}=l,y=w(l,["pathname"]);d+=((s=e.params)!=null&&s.pathname?O(e.params.pathname):"")+"?"+new URLSearchParams(y).toString()}try{i=yield fetch(d,h)}catch(g){return console.error(g),u={status:0,fetchResponse:null,data:null},{data:c,error:u}}let m=yield i.text();try{a=m?JSON.parse(m):null}catch(g){a=m}return i.ok?c=a:u={status:i.status,fetchResponse:i,data:a},{data:c,error:u}})}useQuery(n,e){let[t,h]=R(null),[c,u]=R(null),[i,a]=R(!0),d=m=>U(this,null,function*(){var s,g,y,T;a(!0),(s=e==null?void 0:e.onLoadingStart)==null||s.call(e);let{data:f,error:l}=yield this.request(n,{headers:e==null?void 0:e.headers,method:(e==null?void 0:e.method)||"GET",params:m});return a(!1),(g=e==null?void 0:e.onLoadingEnd)==null||g.call(e),l?(u(l),(y=e==null?void 0:e.onError)==null||y.call(e,{status:l.status,fetchResponse:l.fetchResponse,data:f}),h(null)):f?(h(f),(T=e==null?void 0:e.onSuccess)==null||T.call(e,f),u(null)):console.log("No data or error returned from request!"),{data:f,error:l}});return C(()=>{d(e==null?void 0:e.params)},[]),{data:t,error:c,refetch:d,isLoading:i,isError:!!c}}useMutation(n,e){let[t,h]=R(null),[c,u]=R(null),[i,a]=R(!1);return{data:t,error:c,mutate:(m,f)=>U(this,null,function*(){var g,y,T,L;a(!0),(g=e==null?void 0:e.onLoadingStart)==null||g.call(e);let{data:l,error:s}=yield this.request(n,{method:(e==null?void 0:e.method)||"POST",headers:e==null?void 0:e.headers,body:m,params:f});return a(!1),(y=e==null?void 0:e.onLoadingEnd)==null||y.call(e),s?(u(s),(T=e==null?void 0:e.onError)==null||T.call(e,{status:s.status,fetchResponse:s.fetchResponse,data:l}),h(null)):l?(h(l),(L=e==null?void 0:e.onSuccess)==null||L.call(e,l),u(null)):console.log("No data or error returned from request!"),{data:l,error:s}}),isLoading:i,isError:!!c}}},A=r=>new b(r==null?void 0:r.baseUrl,r==null?void 0:r.headers);export{A as createFetcher};
