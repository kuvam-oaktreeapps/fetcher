var P=Object.defineProperty,C=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var j=(r,n,e)=>n in r?P(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,o=(r,n)=>{for(var e in n||(n={}))k.call(n,e)&&j(r,e,n[e]);if(S)for(var e of S(n))w.call(n,e)&&j(r,e,n[e]);return r},U=(r,n)=>C(r,M(n));var x=(r,n)=>{var e={};for(var t in r)k.call(r,t)&&n.indexOf(t)<0&&(e[t]=r[t]);if(r!=null&&S)for(var t of S(r))n.indexOf(t)<0&&w.call(r,t)&&(e[t]=r[t]);return e};var T=(r,n,e)=>new Promise((t,f)=>{var s=a=>{try{i(e.next(a))}catch(g){f(g)}},u=a=>{try{i(e.throw(a))}catch(g){f(g)}},i=a=>a.done?t(a.value):Promise.resolve(a.value).then(s,u);i((e=e.apply(r,n)).next())});import{useEffect as D,useState as R}from"react";var q=r=>r.replace(/\/$/g,""),N=r=>r.startsWith("/")?r:`/${r}`,b=r=>q(N(r));var L=class{constructor(n,e){this.baseUrl=q(n||"/"),this.headers=()=>o({"Content-Type":"application/json",Accept:"application/json"},e==null?void 0:e())}request(t){return T(this,arguments,function*(n,e={}){var h,c;let f={method:e.method||"GET",body:JSON.stringify(e.body),headers:o(o({"Content-Type":"application/json",Accept:"application/json"},(h=this.headers)==null?void 0:h.call(this)),e==null?void 0:e.headers)},s=null,u=null,i,a,g=this.baseUrl+b(n);if(Object.keys(e.params||{}).length>0){let l=e.params||{},{pathname:d}=l,y=x(l,["pathname"]);g+=((c=e.params)!=null&&c.pathname?b(e.params.pathname):"")+"?"+new URLSearchParams(y).toString()}try{i=yield fetch(g,f)}catch(d){return console.error(d),u={status:0,fetchResponse:null,data:null},{data:s,error:u}}let m=yield i.text();try{a=m?JSON.parse(m):null}catch(d){a=m}return i.ok?s=a:u={status:i.status,fetchResponse:i,data:a},{data:s,error:u}})}useQuery(n,e){let[t,f]=R(null),[s,u]=R(null),[i,a]=R(!0),g=m=>T(this,null,function*(){var c,d,y,E;a(!0),(c=e==null?void 0:e.onLoadingStart)==null||c.call(e);let{data:h,error:l}=yield this.request(n,U(o({},e),{params:m}));return a(!1),(d=e==null?void 0:e.onLoadingEnd)==null||d.call(e),l?(u(l),(y=e==null?void 0:e.onError)==null||y.call(e,{status:l.status,fetchResponse:l.fetchResponse,data:h}),f(null)):h?(f(h),(E=e==null?void 0:e.onSuccess)==null||E.call(e,h),u(null)):console.log("No data or error returned from request!"),{data:h,error:l}});return D(()=>{g(e==null?void 0:e.params)},[]),{data:t,error:s,refetch:g,isLoading:i,isError:!!s}}useMutation(n,e){let[t,f]=R(null),[s,u]=R(null),[i,a]=R(!1);return{data:t,error:s,mutate:(m,h)=>T(this,null,function*(){var d,y,E,O;a(!0),(d=e==null?void 0:e.onLoadingStart)==null||d.call(e);let{data:l,error:c}=yield this.request(n,U(o({},e),{body:m,params:h}));return a(!1),(y=e==null?void 0:e.onLoadingEnd)==null||y.call(e),c?(u(c),(E=e==null?void 0:e.onError)==null||E.call(e,{status:c.status,fetchResponse:c.fetchResponse,data:l}),f(null)):l?(f(l),(O=e==null?void 0:e.onSuccess)==null||O.call(e,l),u(null)):console.log("No data or error returned from request!"),{data:l,error:c}}),isLoading:i,isError:!!s}}},$=r=>new L(r==null?void 0:r.baseUrl,r==null?void 0:r.headers);export{$ as createFetcher};
