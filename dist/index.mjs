var w=Object.defineProperty;var k=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var L=(r,n,e)=>n in r?w(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,E=(r,n)=>{for(var e in n||(n={}))j.call(n,e)&&L(r,e,n[e]);if(k)for(var e of k(n))x.call(n,e)&&L(r,e,n[e]);return r};var U=(r,n,e)=>new Promise((g,d)=>{var l=a=>{try{i(e.next(a))}catch(s){d(s)}},c=a=>{try{i(e.throw(a))}catch(s){d(s)}},i=a=>a.done?g(a.value):Promise.resolve(a.value).then(l,c);i((e=e.apply(r,n)).next())});import{useEffect as C,useState as f}from"react";var b=r=>r.replace(/\/$/g,""),q=r=>r.startsWith("/")?r:`/${r}`;var O=class{constructor(n,e){this.baseUrl=b(n||"/"),this.headers=()=>E({"Content-Type":"application/json",Accept:"application/json"},e==null?void 0:e())}request(g){return U(this,arguments,function*(n,e={}){var T;let d={method:e.method||"GET",body:JSON.stringify(e.body||{}),headers:E(E({"Content-Type":"application/json",Accept:"application/json"},(T=this.headers)==null?void 0:T.call(this)),e==null?void 0:e.headers)},l=null,c=null,i,a,s=this.baseUrl+n;Object.keys(e.params||{}).length>0&&(s+=new URLSearchParams(e.params).toString());try{i=yield fetch(s,d)}catch(t){return console.error(t),c={status:0,fetchResponse:null,data:null},{data:l,error:c}}let h=yield i.text();try{a=h?JSON.parse(h):null}catch(t){a=h}return i.ok?l=a:c={status:i.status,fetchResponse:i,data:a},{data:l,error:c}})}useQuery(n,e){let[g,d]=f(null),[l,c]=f(null),[i,a]=f(!0),s=(...T)=>U(this,[...T],function*(h={}){var y,m,R,S;a(!0),(y=e==null?void 0:e.onLoadingStart)==null||y.call(e);let{data:t,error:u}=yield this.request(q(n),{headers:e==null?void 0:e.headers,method:e==null?void 0:e.method,params:h});return a(!1),(m=e==null?void 0:e.onLoadingEnd)==null||m.call(e),u?(c(u),(R=e==null?void 0:e.onError)==null||R.call(e,{status:u.status,fetchResponse:u.fetchResponse,data:t})):t?(d(t),(S=e==null?void 0:e.onSuccess)==null||S.call(e,t)):console.log("No data or error returned from request!"),{data:t,error:u}});return C(()=>{s(e==null?void 0:e.params)},[]),{data:g,error:l,refetch:s,isLoading:i,isError:!!l}}useMutation(n,e){let[g,d]=f(null),[l,c]=f(null),[i,a]=f(!0);return{data:g,error:l,mutate:(h,T)=>U(this,null,function*(){var y,m,R,S;a(!0),(y=e==null?void 0:e.onLoadingStart)==null||y.call(e);let{data:t,error:u}=yield this.request(q(n),{body:h,headers:e==null?void 0:e.headers,method:(e==null?void 0:e.method)||"POST",params:T});return a(!1),(m=e==null?void 0:e.onLoadingEnd)==null||m.call(e),u?(c(u),(R=e==null?void 0:e.onError)==null||R.call(e,{status:u.status,fetchResponse:u.fetchResponse,data:t})):t?(d(t),(S=e==null?void 0:e.onSuccess)==null||S.call(e,t)):console.log("No data or error returned from request!"),{data:t,error:u}}),isLoading:i,isError:!!l}}},I=r=>new O(r==null?void 0:r.baseUrl,r==null?void 0:r.headers);export{I as createFetcher};
