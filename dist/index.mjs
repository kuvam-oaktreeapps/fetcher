var b=Object.defineProperty;var O=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var k=(n,r,e)=>r in n?b(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e,E=(n,r)=>{for(var e in r||(r={}))w.call(r,e)&&k(n,e,r[e]);if(O)for(var e of O(r))j.call(r,e)&&k(n,e,r[e]);return n};var U=(n,r,e)=>new Promise((g,d)=>{var l=a=>{try{i(e.next(a))}catch(s){d(s)}},c=a=>{try{i(e.throw(a))}catch(s){d(s)}},i=a=>a.done?g(a.value):Promise.resolve(a.value).then(l,c);i((e=e.apply(n,r)).next())});import{useEffect as x,useState as f}from"react";var L=n=>n.replace(/\/$/g,""),o=n=>n.startsWith("/")?n:`/${n}`;var q=class{constructor(r,e){this.baseUrl=L(r),this.headers=()=>E({"Content-Type":"application/json",Accept:"application/json"},e==null?void 0:e())}request(g){return U(this,arguments,function*(r,e={}){var T;let d={method:e.method||"GET",body:JSON.stringify(e.body||{}),headers:E(E({"Content-Type":"application/json",Accept:"application/json"},(T=this.headers)==null?void 0:T.call(this)),e==null?void 0:e.headers)},l=null,c=null,i,a,s=this.baseUrl+r;Object.keys(e.params||{}).length>0&&(s+=new URLSearchParams(e.params).toString());try{i=yield fetch(s,d)}catch(t){return console.error(t),c={status:0,fetchResponse:null,data:null},{data:l,error:c}}let h=yield i.text();try{a=h?JSON.parse(h):null}catch(t){a=h}return i.ok?l=a:c={status:i.status,fetchResponse:i,data:a},{data:l,error:c}})}useQuery(r,e){let[g,d]=f(null),[l,c]=f(null),[i,a]=f(!0),s=(...T)=>U(this,[...T],function*(h={}){var y,m,R,S;a(!0),(y=e==null?void 0:e.onLoadingStart)==null||y.call(e);let{data:t,error:u}=yield this.request(o(r),{headers:e==null?void 0:e.headers,method:e==null?void 0:e.method,params:h});return a(!1),(m=e==null?void 0:e.onLoadingEnd)==null||m.call(e),u?(c(u),(R=e==null?void 0:e.onError)==null||R.call(e,{status:u.status,fetchResponse:u.fetchResponse,data:t})):t?(d(t),(S=e==null?void 0:e.onSuccess)==null||S.call(e,t)):console.log("No data or error returned from request!"),{data:t,error:u}});return x(()=>{s(e==null?void 0:e.params)},[]),{data:g,error:l,refetch:s,isLoading:i,isError:!!l}}useMutation(r,e){let[g,d]=f(null),[l,c]=f(null),[i,a]=f(!0);return{data:g,error:l,mutate:(h,T)=>U(this,null,function*(){var y,m,R,S;a(!0),(y=e==null?void 0:e.onLoadingStart)==null||y.call(e);let{data:t,error:u}=yield this.request(o(r),{body:h,headers:e==null?void 0:e.headers,method:(e==null?void 0:e.method)||"POST",params:T});return a(!1),(m=e==null?void 0:e.onLoadingEnd)==null||m.call(e),u?(c(u),(R=e==null?void 0:e.onError)==null||R.call(e,{status:u.status,fetchResponse:u.fetchResponse,data:t})):t?(d(t),(S=e==null?void 0:e.onSuccess)==null||S.call(e,t)):console.log("No data or error returned from request!"),{data:t,error:u}}),isLoading:i,isError:!!l}}},I=n=>new q(n.baseUrl,n.headers);export{I as createFetcher};
